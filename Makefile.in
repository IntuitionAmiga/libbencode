AR = {AR}
CC = {CC}
CFLAGS = -Wall -O2 -g -fPIC -shared -Iinclude {CFLAGS}
LDFLAGS = {LDFLAGS}
PREFIX = {PREFIX}

LIBMODULES = bencode.o

all:	libbencodetools.so bencodetest

libbencodetools.so:	$(LIBMODULES)
	$(CC) -shared -Wl,-soname,libbencodetools.so -o libbencodetools.so $(LIBMODULES)

bencode.o:	bencode.c include/bencodetools/bencode.h

bencodetest:	bencodetest.o libbencodetools.so
	$(CC) $(LDFLAGS) -o $@ $< -L. -Wl,-rpath,. -lbencodetools

check:	bencodetest
	./bencodetest
	@echo
	@echo "All tests successful"

install:	
	mkdir -p -m 755 "$(PREFIX)/lib" "$(PREFIX)/include/bencodetools"
	install -m 644 include/bencodetools/*.h "$(PREFIX)/include/bencodetools/"
	install -m 644 libbencodetools.so "$(PREFIX)/lib/"

%.o:	%.c
	$(CC) $(CFLAGS) -c $<

clean:	
	rm -f *.o *.so
