AR = {AR}
CC = {CC}
CFLAGS = -Wall -O2 -g -fPIC -shared -Iinclude {CFLAGS}
LDFLAGS = {LDFLAGS}
PREFIX = {PREFIX}

LIBMODULES = bencode.o

all:	libtypevalidator.so bencodetest

libtypevalidator.so:	$(LIBMODULES)
	$(CC) -shared -Wl,-soname,libtypevalidator.so -o libtypevalidator.so $(LIBMODULES)

libtypevalidator.o:	bencode.c include/typevalidator/bencode.h

bencodetest:	bencodetest.o libtypevalidator.so
	$(CC) $(LDFLAGS) -o $@ $< -L. -Wl,-rpath,. -ltypevalidator

check:	bencodetest
	./bencodetest
	@echo
	@echo "All tests successful"

install:	
	mkdir -p -m 755 "$(PREFIX)/lib" "$(PREFIX)/include/typevalidator"
	install -m 644 include/typevalidator/*.h "$(PREFIX)/include/typevalidator/"
	install -m 644 libtypevalidator.so "$(PREFIX)/lib/"

%.o:	%.c
	$(CC) $(CFLAGS) -c $<

clean:	
	rm -f *.o *.so
